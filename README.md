# mall-service
쇼핑몰 서비스 프로토타입 구현하기

---
**주요 개발 환경**
(back-end)
- kotlin
- Spring Boot 3.0.5
- Gradle 7.4

(front-end)
-
-
-

---
**back-end 서버 테스트 실행방법(windows 기준)**
- jdk 17 버전 설치되어있다는 가정 하에, cmd 켜서 .jar 파일 경로에서 다음 명령어 실행 [java -jar (jar 파일명).jar]
- localhost:8080/api-docs : swagger openapi 주소
- localhost:8080/h2-console : 로컬 내장 디비 주소
- 처음 api 테스트 시 준비 사항
  - api/user/sign-up 에서 회원가입 먼저 해야함  
  - api/*/login 에서 로그인 토큰 발급
  - swagger openapi 에 토큰 등록? 후 다른 api 테스트 가능!

-------------------------

**요구 사항**

(공통)
- 사용자 회원가입
- 토큰 인증 기반 로그인
- 배송 처리 스케줄러

(관리자)
- 파트너를 등록/조회/활성or비활성

(파트너)
- 상품 등록/조회/수정/삭제(소프트)
- 판매 수익 조회

(고객)
- 상품 조회
- 상품 상세 조회
- 상품 주문
- 배송 상태 조회
- 리뷰 등록/조회

-------------------------
**요구 사항 상세 정의**

- 사용자 회원가입
  - 사용자는 email, password 를 입력하여 회원가입할 수 있다.
  - email 중복 체크하고, 중복이 되는 경우 예외로 처리되어야한다.
- 토큰 인증 기반 로그인
  - 사용자는 CUSTOMER 의 권한을 가진다.
  - 관리자는 ADMIN 의 권한을 가진다.
  - 파트너는 PARTNER 의 권한을 가진다.
- 배송 처리 스케줄러
  - 스케줄러가 배송 처리를 담당해준다.
  - 프로토타입이기 때문에 5분 기준으로 배송 처리가 한단계씩 진행된다.

- 파트너를 등록/조회/활성or비활성
  - 파트너는 email, password, 브랜드 이름, 사업자등록번호의 정보 입력을 통해 등록될 수 있다. 활성 여부의 기본값은 활성이다.
  - 파트너 email 중복 체크하고, 중복이 되는 경우 예외로 처리되어야한다.
  - 파트너의 email, 이름, 사업자등록번호, 활성여부를 조회할 수 있다.
  - 파트너의 활성여부를 수정할 수 있다.
- 상품 등록/조회/수정/삭제(소프트)
  - 상품 -> 상품명, 상품기본가격, 상품옵션목록, 노출여부
  - 상품옵션목록 -> 상품옵션(색상, 사이즈를 모두 포함한다), 추가금액, 수량
- 판매 수익 조회

- 배송지 등록/조회/삭제
  - 배송지는 주소, 상세주소, 우편번호 정보를 가진다.
  - 사용자 당 여러 개의 배송지를 가질 수 있다.
- 상품 조회
  - 브랜드 목록 조회할 수 있다.
  - 기본 조회는 등록상품순으로 20건씩 조회할 수 있다.
  - 브랜드별 상품 조회할 수 있다.
  - 상품 상세 조회를 할 수 있다.
- 상품 주문
  - 재고가 있는 경우 상품을 주문할 수 있다. 주문 후, 재고수량이 감소한다.
  - 결제 기능은 논외로 한다.
  - 배송이 '주문완료' 상태일 때 주문을 취소할 수 있다. 주문 취소 후 재고수량이 이전 값으로 원복된다.
  - 모든 주문 이력을 조회할 수 있다.
  - 모든 주문 이력은 각각 상세 조회할 수 있다.
- 배송 상태 조회
  - 배송 상태는 주문완료 -> 배송준비중 -> 배송중 -> 배송완료 상태가 있다.
  - 상품 배송 상태를 조회할 수 있다.
- 리뷰 등록/조회
  - 배송완료 상태인 주문 건에 대해 리뷰를 등록할 수 있다.
-------------------------
**프로젝트 구조 및 코드 규칙**
- 패키지 구조
  - application
  - domain
  - infrastructure
  - interfaces
  - support
- (공통) 모든 input/output dto 는 중첩클래스로 작성한다. 이는 파일 수를 줄이고 가독성을 높이기 위함이다.
- domain 계층은 주요 비즈니스 로직이 작성된 클래스의 집합이다. 따라서, 쉽게 변하지 않는 코드 영역이다. 이를 추상화 수준이 높다고 할 수 있다.
- 함수의 파라미터 및 리턴값으로 사용되는 dto 의 중첩클래스의 네이밍은 함수명을 따른다.
- domain 계층의 input dto 의 파일명의 네이밍은 *command 형식을 따른다.
- domain 계층의 output dto 의 파일명의 네이밍은 *info 형식을 따른다.
- domain 계층은 infrastructure 계층을 의존하지 않는다. 이를 방지하기 위해 domain 계층은 인터페이스를 가지고 있고, 이 인터페이스를 infratructure 가 구현함으로서 의존성 역전 원칙을 따른다(DIP)
- 같은 aggregate 엔티티 간의 관계 fk 는 pk 로 된 id 값으로 하고, 다른 aggregate 간의 관계 fk 는 pk 의 대체키인 *token 으로 한다.
- application 계층은 다른 aggregate 를 묶어주는 aggregation? 역할을 하는 계층이다.
- interfaces 는 클라이언트 요청을 받는 영역이다. input, output dto 는 *ApiDto 라는 파일명을 가지고, 중첩클래스 네이밍은 *Request/*Response 를 따른다.
- PathVariable 은 *token 을로 한다. pk 를 PathVariable 로 받지 않기 위함이다. 왜냐하면 사용자에게 데이터 저장 순서를 노출하지 않기 위함이다.
- 같은 aggregate 의 엔티티는 id pk 로 참조하고, 다른 aggregate 의 엔티티와는 *token 으로 참조한다.

-------------------------
**회고**
- 2023.04.21
  - 시작이 반이라고 생각한다. 오늘은 레파지토리 만드는 것부터 했으니 벌써 반절 온 것 같다!
- 2023.04.26
  - 코틀린의 기본 사용법을 좀 더 익혀야 될 것 같다. 엔티티 필드의 초기값.. 생성자.. 등 선언 시 자바를 사용할 때와 비교해볼 때 허점이 많은 것 같다.
  - 주문 관련 엔티티가 상품 관련 엔티티와 어떻게 관계를 가져가야할지, 객체 참조가 필요할지, 값을 복사해서 쓸지 고민이 되었다. 값을 복사해야 될 것 같다. 상품 수정 시 주문되었던 상품가격이나 정보가 변경되면 안되기 때문이다. 그치만 요청으로부터 price 가 들어올 때 올바른 가격인지 어떻게 유효성을 체크할 수 있을까...
- 2023.04.30
  - 엔티티를 가져왔을 때 없으면 예외를 던지는데 인프라스트럭처 계층에서 던지는 게 좋을지, 도메인 계층에서 던지는 게 좋을지 고민이 되었다. 예외에도 종류가 있고 상황에 따라 적절한 예외를 던져야하고, "상황에 따라" 라는 표현 자체가 비즈니스 로직이라고 생각이 되기 때문에 도메인 계층에서 던지기로 했다.
- 2023.05.18
  - auth 관련한 기능들 패키지 구조 어떻게 가져가야될지 고민 필요하다ㅠㅠ common 기능을 하는 support 에 둘지., domain > auth 에 둘지!!   
